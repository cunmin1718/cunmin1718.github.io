<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人笔记"><title>k8s安装 | 记忆不靠谱</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">k8s安装</h1><a id="logo" href="/.">记忆不靠谱</a><p class="description">人生很奇妙，过好每一天</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">k8s安装</h1><div class="post-meta">Sep 4, 2019<span> | </span><span class="category"><a href="/categories/k8s/">k8s</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础环境安装"><span class="toc-number">1.</span> <span class="toc-text">基础环境安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装docker（略）"><span class="toc-number">1.1.</span> <span class="toc-text">安装docker（略）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装CFSSL（略）"><span class="toc-number">1.2.</span> <span class="toc-text">安装CFSSL（略）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建CA证书和密钥"><span class="toc-number">2.</span> <span class="toc-text">创建CA证书和密钥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建-CA-配置文件"><span class="toc-number">2.1.</span> <span class="toc-text">创建 CA 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建-CA-证书签名请求"><span class="toc-number">2.2.</span> <span class="toc-text">创建 CA 证书签名请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成CA和私钥"><span class="toc-number">2.3.</span> <span class="toc-text">生成CA和私钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建kubernetes证书签名请求文件"><span class="toc-number">2.4.</span> <span class="toc-text">创建kubernetes证书签名请求文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成kubernetes证书和私钥"><span class="toc-number">2.5.</span> <span class="toc-text">生成kubernetes证书和私钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建admin证书签名请求文件"><span class="toc-number">2.6.</span> <span class="toc-text">创建admin证书签名请求文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成admin证书和私钥"><span class="toc-number">2.7.</span> <span class="toc-text">生成admin证书和私钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建kube-proxy证书签名请求文件"><span class="toc-number">2.8.</span> <span class="toc-text">创建kube-proxy证书签名请求文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成kube-proxy客户端证书和私钥"><span class="toc-number">2.9.</span> <span class="toc-text">生成kube-proxy客户端证书和私钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#证书分发"><span class="toc-number">2.10.</span> <span class="toc-text">证书分发</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#部署Etcd集群"><span class="toc-number">3.</span> <span class="toc-text">部署Etcd集群</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#解压etcd"><span class="toc-number">3.1.</span> <span class="toc-text">解压etcd</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建工作目录和配置目录"><span class="toc-number">3.2.</span> <span class="toc-text">创建工作目录和配置目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建etcd配置文件"><span class="toc-number">3.3.</span> <span class="toc-text">创建etcd配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建系统服务文件"><span class="toc-number">3.4.</span> <span class="toc-text">创建系统服务文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动-etcd-服务"><span class="toc-number">3.5.</span> <span class="toc-text">启动 etcd 服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查etcd集群服务的健康"><span class="toc-number">3.6.</span> <span class="toc-text">检查etcd集群服务的健康</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#部署Flannel网络"><span class="toc-number">4.</span> <span class="toc-text">部署Flannel网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">4.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#向etcd中写入网段信息，只需要在一台执行即可"><span class="toc-number">4.2.</span> <span class="toc-text">向etcd中写入网段信息，只需要在一台执行即可</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置Flannel"><span class="toc-number">4.3.</span> <span class="toc-text">配置Flannel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#systemd管理Flannel"><span class="toc-number">4.4.</span> <span class="toc-text">systemd管理Flannel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动Flanneld服务"><span class="toc-number">4.5.</span> <span class="toc-text">启动Flanneld服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查flanneld服务状态"><span class="toc-number">4.6.</span> <span class="toc-text">检查flanneld服务状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置docker使用flanneld网络"><span class="toc-number">4.7.</span> <span class="toc-text">配置docker使用flanneld网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动docker"><span class="toc-number">4.8.</span> <span class="toc-text">启动docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查是否生效"><span class="toc-number">4.9.</span> <span class="toc-text">检查是否生效</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装kubernetes"><span class="toc-number">5.</span> <span class="toc-text">安装kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#下载"><span class="toc-number">5.1.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署master节点"><span class="toc-number">5.2.</span> <span class="toc-text">部署master节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装文件"><span class="toc-number">5.2.1.</span> <span class="toc-text">安装文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署apiserver服务"><span class="toc-number">5.2.2.</span> <span class="toc-text">部署apiserver服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建token文件"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">创建token文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建apiserver配置文件"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">创建apiserver配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd管理apiserver"><span class="toc-number">5.2.2.3.</span> <span class="toc-text">systemd管理apiserver</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动"><span class="toc-number">5.2.2.4.</span> <span class="toc-text">启动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署-schduler-服务"><span class="toc-number">5.2.3.</span> <span class="toc-text">部署 schduler 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建schduler配置文件"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">创建schduler配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd管理schduler组件"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">systemd管理schduler组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-1"><span class="toc-number">5.2.3.3.</span> <span class="toc-text">启动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署-controller-manager-服务"><span class="toc-number">5.2.4.</span> <span class="toc-text">部署 controller-manager 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建controller-manager配置文件"><span class="toc-number">5.2.4.1.</span> <span class="toc-text">创建controller-manager配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd管理controller-manager组件"><span class="toc-number">5.2.4.2.</span> <span class="toc-text">systemd管理controller-manager组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-2"><span class="toc-number">5.2.4.3.</span> <span class="toc-text">启动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证master节点"><span class="toc-number">5.2.5.</span> <span class="toc-text">验证master节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署kubectl工具"><span class="toc-number">5.3.</span> <span class="toc-text">部署kubectl工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载安装"><span class="toc-number">5.3.1.</span> <span class="toc-text">下载安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建-root-kube-config文件"><span class="toc-number">5.3.2.</span> <span class="toc-text">创建/root/.kube/config文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建bootstartp-kubeconfig文件"><span class="toc-number">5.3.3.</span> <span class="toc-text">创建bootstartp.kubeconfig文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建kube-proxy-kubeconfig"><span class="toc-number">5.3.3.1.</span> <span class="toc-text">创建kube-proxy.kubeconfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将生成的配置文件拷贝到其他的节点"><span class="toc-number">5.3.3.2.</span> <span class="toc-text">将生成的配置文件拷贝到其他的节点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署Node节点"><span class="toc-number">5.4.</span> <span class="toc-text">部署Node节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#授权"><span class="toc-number">5.4.1.</span> <span class="toc-text">授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装kubelet和kube-proxy"><span class="toc-number">5.4.2.</span> <span class="toc-text">安装kubelet和kube-proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建kubelet配置文件"><span class="toc-number">5.4.3.</span> <span class="toc-text">创建kubelet配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#systemd管理kubelet组件"><span class="toc-number">5.4.4.</span> <span class="toc-text">systemd管理kubelet组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动-3"><span class="toc-number">5.4.5.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行TLS证书授权请求"><span class="toc-number">5.4.6.</span> <span class="toc-text">执行TLS证书授权请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建kube-proxy配置文件"><span class="toc-number">5.4.7.</span> <span class="toc-text">创建kube-proxy配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#systemd管理kube-proxy组件"><span class="toc-number">5.4.8.</span> <span class="toc-text">systemd管理kube-proxy组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动-4"><span class="toc-number">5.4.9.</span> <span class="toc-text">启动</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="基础环境安装"><a href="#基础环境安装" class="headerlink" title="基础环境安装"></a>基础环境安装</h1><h2 id="安装docker（略）"><a href="#安装docker（略）" class="headerlink" title="安装docker（略）"></a>安装docker（略）</h2><h2 id="安装CFSSL（略）"><a href="#安装CFSSL（略）" class="headerlink" title="安装CFSSL（略）"></a>安装CFSSL（略）</h2><h1 id="创建CA证书和密钥"><a href="#创建CA证书和密钥" class="headerlink" title="创建CA证书和密钥"></a>创建CA证书和密钥</h1><table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">公钥与私钥</th>
</tr>
</thead>
<tbody><tr>
<td align="left">根证书公钥与私钥</td>
<td align="left">ca.pem与ca.key</td>
</tr>
<tr>
<td align="left">API Server公钥与私钥</td>
<td align="left">apiserver.pem与apiserver.key</td>
</tr>
<tr>
<td align="left">集群管理员公钥与私钥</td>
<td align="left">admin.pem与admin.key</td>
</tr>
<tr>
<td align="left">节点proxy公钥与私钥</td>
<td align="left">proxy.pem与proxy.key</td>
</tr>
</tbody></table>
<p>节点kubelet的公钥与私钥：是通过boostrap响应的方式，在启动kubelet自动会产生, 然后在master通过csr请求，就会产生。</p>
<p>kubernetes系统各组件需要使用TLS证书对通信进行加密，本本档使用CloudFlare的工具集cfssl来生成Certificate Authority(CA)证书和密钥文件，CA是自签名的证书，用来签名后续创建的其他TLS证书。</p>
<p>以下操作都在master节点上执行，证书只需要创建一次即可，以后新增节点时，只需要将/etc/kubernetes/目录下的证书拷贝到新节点即可。</p>
<h2 id="创建-CA-配置文件"><a href="#创建-CA-配置文件" class="headerlink" title="创建 CA 配置文件"></a>创建 CA 配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/ssl</span><br><span class="line">cd /root/ssl</span><br><span class="line"></span><br><span class="line">cat &gt; ca-config.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;signing&quot;: &#123;</span><br><span class="line">    &quot;default&quot;: &#123;</span><br><span class="line">      &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;profiles&quot;: &#123;</span><br><span class="line">      &quot;kubernetes&quot;: &#123;</span><br><span class="line">        &quot;usages&quot;: [</span><br><span class="line">          &quot;signing&quot;,</span><br><span class="line">          &quot;key encipherment&quot;,</span><br><span class="line">          &quot;server auth&quot;,</span><br><span class="line">          &quot;client auth&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>ca-config.json：可以定义多个profiles，分别指定不同的过期时间，使用场景等参数，后续在签名证书时会使用到某个profile；</li>
<li>signing：表示该证书可用于签名其他证书；生成ca.pem证书中的CA=TRUE；</li>
<li>server auto：表示client可以用该CA对server提供的证书进行验证；</li>
<li>client auth：表示server可以用该CA对client提供的证书进行验证</li>
</ul>
<h2 id="创建-CA-证书签名请求"><a href="#创建-CA-证书签名请求" class="headerlink" title="创建 CA 证书签名请求"></a>创建 CA 证书签名请求</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ca-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">  &quot;key&quot;: &#123;</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>“CN”：Common Name，kube-apiserver从证书中提取该字段作为请求的用户名(User name)；浏览器检验该字段验证网站是否合法；</li>
<li>“O”：Organization，kube-apiserver从证书提取该字段作为请求用户所属的组（Group）；</li>
</ul>
<h2 id="生成CA和私钥"><a href="#生成CA和私钥" class="headerlink" title="生成CA和私钥"></a>生成CA和私钥</h2><p>生成CA所必需的文件ca-key.pem（私钥）和ca.pem（证书），还会生成ca.csr（证书签名请求），用于交叉签名或重新签名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca</span><br></pre></td></tr></table></figure>

<h2 id="创建kubernetes证书签名请求文件"><a href="#创建kubernetes证书签名请求文件" class="headerlink" title="创建kubernetes证书签名请求文件"></a>创建kubernetes证书签名请求文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubernetes-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">   &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">    &quot;hosts&quot;: [</span><br><span class="line">      &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;192.168.56.101&quot;,</span><br><span class="line">      &quot;192.168.56.102&quot;,</span><br><span class="line">      &quot;192.168.56.103&quot;,</span><br><span class="line">      &quot;10.254.0.1&quot;, //这是后面dns要使用的虚拟网络的网关，不用改，就用这个切忌(删除这行)</span><br><span class="line">      &quot;kubernetes&quot;,</span><br><span class="line">      &quot;kubernetes.default&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc.cluster&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc.cluster.local&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">            &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>hosts中的内容可以为空，即是按照上面的配置，向集群中增加新节点也不需要重新生成证书；如果hosts不为空，则需要指定授权使用该证书的IP或域名列表，由于该证书后续被etcd集群和kubernetes master集群使用，所以上面分别指定了etcd集群，kubernetes master集群的主机IP和kuberunetes服务ip。</li>
</ul>
<h2 id="生成kubernetes证书和私钥"><a href="#生成kubernetes证书和私钥" class="headerlink" title="生成kubernetes证书和私钥"></a>生成kubernetes证书和私钥</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kubernetes-csr.json | cfssljson -bare kubernetes</span><br></pre></td></tr></table></figure>

<h2 id="创建admin证书签名请求文件"><a href="#创建admin证书签名请求文件" class="headerlink" title="创建admin证书签名请求文件"></a>创建admin证书签名请求文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; admin-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;CN&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: &#123;</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;system:masters&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>kube-apiserver 使用RBAC对客户端（如Kubelet,kube-proxy,Pod）请求进行授权。</li>
<li>kube-apiserver 预定义了一些RBAC使用的RoleBindings，如cluster-admin将Group System：masters与Role cluster-admin绑定，该Role授予kube-apiserver的所有API的权限；</li>
<li>OU指定该证书的Group为system:masters，kubelet使用该证书访问kube-apiserver时，由于证书为CA签名，所以认证通过，同时由于证书用户组为经过预授权的system：masters，所以被授予访问所有API的权限</li>
</ul>
<h2 id="生成admin证书和私钥"><a href="#生成admin证书和私钥" class="headerlink" title="生成admin证书和私钥"></a>生成admin证书和私钥</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin</span><br></pre></td></tr></table></figure>

<h2 id="创建kube-proxy证书签名请求文件"><a href="#创建kube-proxy证书签名请求文件" class="headerlink" title="创建kube-proxy证书签名请求文件"></a>创建kube-proxy证书签名请求文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kube-proxy-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;CN&quot;: &quot;system:kube-proxy&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: &#123;</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>CN指定该证书的User为system：kube-proxy；</li>
<li>kube-apiserver预定义的RoleBinding cluster-admin将User system：kube-proxy与Role System：node-proxies绑定，该Role授予了调用kube-apiserver Proxy相关API的权限；</li>
</ul>
<h2 id="生成kube-proxy客户端证书和私钥"><a href="#生成kube-proxy客户端证书和私钥" class="headerlink" title="生成kube-proxy客户端证书和私钥"></a>生成kube-proxy客户端证书和私钥</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes  kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br></pre></td></tr></table></figure>

<h2 id="证书分发"><a href="#证书分发" class="headerlink" title="证书分发"></a>证书分发</h2><p>将生成的证书和密钥文件（后缀为pem）拷贝到所有机器的/etc/kubernetes/ssl目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/kubernetes/ssl</span><br><span class="line">cp *.pem /etc/kubernetes/ssl</span><br><span class="line"></span><br><span class="line">ssh node01 &quot;mkdir -p /etc/kubernetes/ssl&quot;</span><br><span class="line">scp *.pem node01:/etc/kubernetes/ssl</span><br><span class="line"></span><br><span class="line">ssh node02 &quot;mkdir -p /etc/kubernetes/ssl&quot;</span><br><span class="line">scp *.pem node02:/etc/kubernetes/ssl</span><br></pre></td></tr></table></figure>

<h1 id="部署Etcd集群"><a href="#部署Etcd集群" class="headerlink" title="部署Etcd集群"></a>部署Etcd集群</h1><p>在三个节点都需要安装etcd，下面的操作在每台机器上操作一遍。</p>
<h2 id="解压etcd"><a href="#解压etcd" class="headerlink" title="解压etcd"></a>解压etcd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf etcd-v3.3.10-linux-amd64.tar.gz</span><br><span class="line">cd etcd-v3.3.10-linux-amd64</span><br><span class="line">mv etcd etcdctl /usr/local/bin</span><br></pre></td></tr></table></figure>

<h2 id="创建工作目录和配置目录"><a href="#创建工作目录和配置目录" class="headerlink" title="创建工作目录和配置目录"></a>创建工作目录和配置目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/lib/etcd</span><br><span class="line">mkdir -p /etc/etcd</span><br></pre></td></tr></table></figure>

<h2 id="创建etcd配置文件"><a href="#创建etcd配置文件" class="headerlink" title="创建etcd配置文件"></a>创建etcd配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/etcd/etcd.conf</span><br><span class="line">#[Member]</span><br><span class="line">ETCD_NAME=&quot;etcd01&quot;</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.56.101:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.56.101:2379&quot;</span><br><span class="line"></span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.56.101:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.56.101:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;etcd01=https://192.168.56.101:2380,etcd02=https://192.168.56.102:2380,etcd03=https://192.168.56.103:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>ETCD_NAME: 本member的名称</li>
<li>ETCD_DATA_DIR: 存储的数据目录</li>
<li>ETCD_LISTEN_PEER_URLS: 用于监听集群中其它member的连接；0.0.0.0表示监听本机所有地址；</li>
<li>ETCD_LISTEN_CLIENT_URLS: 用于监听客户端etcdctl或者curl连接；0.0.0.0表示监听本机所有地址；</li>
<li>ETCD_INITIAL_ADVERTISE_PEER_URLS: 本机地址，用于通知集群member，与member通信；</li>
<li>ETCD_ADVERTISE_CLIENT_URLS: 本机地址， 用于通知客户端，客户端通过此IPs与集群通信;</li>
<li>ETCD_INITIAL_CLUSTER: 描述集群中所有节点的信息，描述每个节点名称、ip、端口，集群静态启动使用，本member根据此信息去联系其他member；</li>
<li>ETCD_INITIAL_CLUSTER_TOKEN: 集群唯一标示；</li>
<li>ETCD_INITIAL_CLUSTER_STATE: 集群状态，新建集群时候设置为new，若是想加入某个已经存在的集群设置为existing</li>
</ul>
<h2 id="创建系统服务文件"><a href="#创建系统服务文件" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/etcd.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line">Documentation=https://github.com/coreos</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">WorkingDirectory=/var/lib/etcd/</span><br><span class="line">EnvironmentFile=-/etc/etcd/etcd.conf</span><br><span class="line">ExecStart=/usr/local/bin/etcd \</span><br><span class="line">  --name $&#123;ETCD_NAME&#125; \</span><br><span class="line">  --data-dir=$&#123;ETCD_DATA_DIR&#125; \</span><br><span class="line">  --listen-peer-urls=$&#123;ETCD_LISTEN_PEER_URLS&#125; \</span><br><span class="line">  --listen-client-urls=$&#123;ETCD_LISTEN_CLIENT_URLS&#125;,http://127.0.0.1:2379 \</span><br><span class="line">  --advertise-client-urls=$&#123;ETCD_ADVERTISE_CLIENT_URLS&#125; \</span><br><span class="line">  --initial-advertise-peer-urls=$&#123;ETCD_INITIAL_ADVERTISE_PEER_URLS&#125; \</span><br><span class="line">  --initial-cluster=$&#123;ETCD_INITIAL_CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-token=$&#123;ETCD_INITIAL_CLUSTER_TOKEN&#125; \</span><br><span class="line">  --initial-cluster-state=$&#123;ETCD_INITIAL_CLUSTER_STATE&#125; \</span><br><span class="line">  --cert-file=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">  --key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">  --peer-cert-file=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">  --peer-key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">  --trusted-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --peer-trusted-ca-file=/etc/kubernetes/ssl/ca.pem</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<ul>
<li>指定etcd的工作目录为/var/lib/etcd，数据目录为/var/lib/etcd，需在启动服务前创建这个目录，否则启动服务的时候会报错“Failed at step CHDIR spawning /usr/bin/etcd: No such file or directory”；</li>
<li>为了保证通信安全，需要指定etcd的公私钥(cert-file和key-file),Peers通信的公私钥和CA 证书(peer-cert-file、peer-key-file、peer-trusted-ca-file)、客户端的CA证书（trusted-ca-file）；</li>
<li>创建kubernetes.pem证书时使用的kubernestes-csr.json文件的hosts字段包含所有的etcd节点的IP，否则证书校验会出错；</li>
<li>–initial-cluster-state值为new时，-name的参数值必须位于-initial-cluster列表中；</li>
</ul>
<h2 id="启动-etcd-服务"><a href="#启动-etcd-服务" class="headerlink" title="启动 etcd 服务"></a>启动 etcd 服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable etcd</span><br><span class="line">systemctl start etcd</span><br><span class="line">systemctl status etcd</span><br></pre></td></tr></table></figure>

<h2 id="检查etcd集群服务的健康"><a href="#检查etcd集群服务的健康" class="headerlink" title="检查etcd集群服务的健康"></a>检查etcd集群服务的健康</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl \</span><br><span class="line">    --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">    --cert-file=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">    --key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">    cluster-health</span><br></pre></td></tr></table></figure>

<h1 id="部署Flannel网络"><a href="#部署Flannel网络" class="headerlink" title="部署Flannel网络"></a>部署Flannel网络</h1><p>在node节点上都需要部署安装</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf flannel-v0.11.0-linux-amd64.tar.gz </span><br><span class="line">mv flanneld mk-docker-opts.sh /usr/local/bin</span><br></pre></td></tr></table></figure>

<h2 id="向etcd中写入网段信息，只需要在一台执行即可"><a href="#向etcd中写入网段信息，只需要在一台执行即可" class="headerlink" title="向etcd中写入网段信息，只需要在一台执行即可"></a>向etcd中写入网段信息，只需要在一台执行即可</h2><p>Falnnel要用etcd存储自身一个子网信息，所以要保证能成功连接Etcd，写入预定义子网段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl --endpoints=https://192.168.56.101:2379,https://192.168.56.102:2379,https://192.168.56.103:2379 \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">  --key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">  mk /kubernetes/network/config &apos;&#123;&quot;Network&quot;:&quot;172.30.0.0/16&quot;,&quot;SubnetLen&quot;:24,&quot;Backend&quot;:&#123;&quot;Type&quot;:&quot;vxlan&quot;&#125;&#125;&apos;</span><br></pre></td></tr></table></figure>

<h2 id="配置Flannel"><a href="#配置Flannel" class="headerlink" title="配置Flannel"></a>配置Flannel</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/kubernetes/cfg</span><br><span class="line"></span><br><span class="line">vim /etc/kubernetes/cfg/flanneld</span><br><span class="line">FLANNEL_OPTIONS=&quot;--etcd-endpoints=https://192.168.56.101:2379,https://192.168.56.102:2379,https://192.168.56.103:2379 -etcd-cafile=/etc/kubernetes/ssl/ca.pem -etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem -etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem -etcd-prefix=/kubernetes/network -iface-regex=eth*|enp*&quot;</span><br></pre></td></tr></table></figure>

<h2 id="systemd管理Flannel"><a href="#systemd管理Flannel" class="headerlink" title="systemd管理Flannel"></a>systemd管理Flannel</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/flanneld.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Flanneld overlay address etcd agent</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=etcd.service</span><br><span class="line">Before=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=/etc/kubernetes/cfg/flanneld</span><br><span class="line">ExecStart=/usr/local/bin/flanneld --ip-masq $FLANNEL_OPTIONS</span><br><span class="line">ExecStartPost=/usr/local/bin/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">RequiredBy=docker.service</span><br></pre></td></tr></table></figure>
<ul>
<li>mk-docker-opts.sh：将分配给flanneld的pod子网网段信息写入到/run/flannel/docker文件中，后续docker启动时使用这个文件中参数值设置docker0网桥</li>
<li>flanneld使用系统缺省路由所在的接口和其他节点通信，对于有多个网络接口的机器（如内网和公网），可使用-iface=enpxx选项值指定通信接口；</li>
</ul>
<h2 id="启动Flanneld服务"><a href="#启动Flanneld服务" class="headerlink" title="启动Flanneld服务"></a>启动Flanneld服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable flanneld</span><br><span class="line">systemctl start flanneld</span><br><span class="line">systemctl status flanneld</span><br></pre></td></tr></table></figure>

<h2 id="检查flanneld服务状态"><a href="#检查flanneld服务状态" class="headerlink" title="检查flanneld服务状态"></a>检查flanneld服务状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl --endpoints=https://192.168.56.101:2379,https://192.168.56.102:2379,https://192.168.56.103:2379 \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">  --key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">get /kubernetes/network/config</span><br></pre></td></tr></table></figure>

<h2 id="配置docker使用flanneld网络"><a href="#配置docker使用flanneld网络" class="headerlink" title="配置docker使用flanneld网络"></a>配置docker使用flanneld网络</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line"># 新增</span><br><span class="line">EnvironmentFile=/run/flannel/docker</span><br><span class="line"># 修改</span><br><span class="line">ExecStart=/usr/bin/dockerd $DOCKER_NETWORK_OPTIONS</span><br><span class="line"></span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<ul>
<li>flanneld 启动时将网络配置写入到 /run/flannel/docker 文件中的变量 DOCKER_NETWORK_OPTIONS，dockerd 命令行上指定该变量值来设置 docker0 网桥参数；</li>
<li>如果指定了多个 EnvironmentFile 选项，则必须将 /run/flannel/docker 放在最后(确保 docker0 使用 flanneld 生成的 bip 参数)；</li>
<li>不能关闭默认开启的 –iptables 和 –ip-masq 选项；</li>
<li>如果内核版本比较新，建议使用 overlay 存储驱动；</li>
<li>–exec-opt native.cgroupdriver=systemd参数可以指定为”cgroupfs”或者“systemd”</li>
</ul>
<h2 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure>

<h2 id="检查是否生效"><a href="#检查是否生效" class="headerlink" title="检查是否生效"></a>检查是否生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef |grep docker</span><br></pre></td></tr></table></figure>
<blockquote>
<p>确保docker0与flannel.1在同一网段。<br>测试不同节点互通，在当前节点访问另一个Node节点docker0 IP</p>
</blockquote>
<h1 id="安装kubernetes"><a href="#安装kubernetes" class="headerlink" title="安装kubernetes"></a>安装kubernetes</h1><p>在部署Kubernetes之前一定要确保etcd、flannel、docker是正常工作的，否则先解决问题再继续。</p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://storage.googleapis.com/kubernetes-release/release/v1.16.3/kubernetes-server-linux-amd64.tar.gz 国内下载地址</span><br></pre></td></tr></table></figure>

<h2 id="部署master节点"><a href="#部署master节点" class="headerlink" title="部署master节点"></a>部署master节点</h2><h3 id="安装文件"><a href="#安装文件" class="headerlink" title="安装文件"></a>安装文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## 主节点</span><br><span class="line">cp -r kubernetes/server/bin/&#123;kube-apiserver,kube-controller-manager,kube-scheduler&#125; /usr/local/bin/</span><br></pre></td></tr></table></figure>

<h3 id="部署apiserver服务"><a href="#部署apiserver服务" class="headerlink" title="部署apiserver服务"></a>部署apiserver服务</h3><h4 id="创建token文件"><a href="#创建token文件" class="headerlink" title="创建token文件"></a>创建token文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#生成token 变量</span><br><span class="line">export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &apos; &apos;)</span><br><span class="line"></span><br><span class="line">cat &gt; token.csv &lt;&lt;EOF</span><br><span class="line">$&#123;BOOTSTRAP_TOKEN&#125;,kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mv token.csv /etc/kubernetes/cfg</span><br></pre></td></tr></table></figure>

<h4 id="创建apiserver配置文件"><a href="#创建apiserver配置文件" class="headerlink" title="创建apiserver配置文件"></a>创建apiserver配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/cfg/kube-apiserver</span><br><span class="line"></span><br><span class="line">KUBE_APISERVER_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--etcd-servers=https://192.168.56.101:2379,https://192.168.56.102:2379,https://192.168.56.103:2379 \</span><br><span class="line">--bind-address=192.168.56.101 \</span><br><span class="line">--secure-port=6443 \</span><br><span class="line">--advertise-address=192.168.56.101 \</span><br><span class="line">--allow-privileged=true \</span><br><span class="line">--service-cluster-ip-range=10.254.0.0/16 \</span><br><span class="line">--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \</span><br><span class="line">--authorization-mode=RBAC,Node \</span><br><span class="line">--enable-bootstrap-token-auth \</span><br><span class="line">--token-auth-file=/etc/kubernetes/cfg/token.csv \</span><br><span class="line">--service-node-port-range=30000-50000 \</span><br><span class="line">--tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem  \</span><br><span class="line">--tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">--client-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">--service-account-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">--etcd-cafile=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">--etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">--etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem&quot;</span><br></pre></td></tr></table></figure>
<p>配置好前面生成的证书，确保能连接etcd。</p>
<p>参数说明：</p>
<ul>
<li>–logtostderr 启用日志</li>
<li>–v 日志等级</li>
<li>–etcd-servers etcd集群地址</li>
<li>–bind-address 监听地址</li>
<li>–secure-port https安全端口</li>
<li>–advertise-address 集群通告地址</li>
<li>–allow-privileged 启用授权</li>
<li>–service-cluster-ip-range Service虚拟IP地址段</li>
<li>–enable-admission-plugins 准入控制模块</li>
<li>–authorization-mode 认证授权，启用RBAC授权和节点自管理</li>
<li>–enable-bootstrap-token-auth 启用TLS bootstrap功能，后面会讲到</li>
<li>–token-auth-file token文件</li>
<li>–service-node-port-range Service Node类型默认分配端口范围</li>
</ul>
<h4 id="systemd管理apiserver"><a href="#systemd管理apiserver" class="headerlink" title="systemd管理apiserver"></a>systemd管理apiserver</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/kube-apiserver.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line">After=etcd.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/etc/kubernetes/cfg/kube-apiserver</span><br><span class="line">ExecStart=/usr/local/bin/kube-apiserver $KUBE_APISERVER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-apiserver</span><br><span class="line">systemctl start kube-apiserver</span><br><span class="line">systemctl status kube-apiserver</span><br></pre></td></tr></table></figure>

<h3 id="部署-schduler-服务"><a href="#部署-schduler-服务" class="headerlink" title="部署 schduler 服务"></a>部署 schduler 服务</h3><h4 id="创建schduler配置文件"><a href="#创建schduler配置文件" class="headerlink" title="创建schduler配置文件"></a>创建schduler配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/cfg/kube-scheduler</span><br><span class="line"></span><br><span class="line">KUBE_SCHEDULER_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--master=127.0.0.1:8080 \</span><br><span class="line">--leader-elect&quot;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>–master 连接本地apiserver</li>
<li>–leader-elect 当该组件启动多个时，自动选举（HA）</li>
</ul>
<h4 id="systemd管理schduler组件"><a href="#systemd管理schduler组件" class="headerlink" title="systemd管理schduler组件"></a>systemd管理schduler组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/kube-scheduler.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Scheduler</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/etc/kubernetes/cfg/kube-scheduler</span><br><span class="line">ExecStart=/usr/local/bin/kube-scheduler $KUBE_SCHEDULER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-scheduler</span><br><span class="line">systemctl start kube-scheduler</span><br><span class="line">systemctl status kube-scheduler</span><br></pre></td></tr></table></figure>

<h3 id="部署-controller-manager-服务"><a href="#部署-controller-manager-服务" class="headerlink" title="部署 controller-manager 服务"></a>部署 controller-manager 服务</h3><h4 id="创建controller-manager配置文件"><a href="#创建controller-manager配置文件" class="headerlink" title="创建controller-manager配置文件"></a>创建controller-manager配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/cfg/kube-controller-manager</span><br><span class="line"></span><br><span class="line">KUBE_CONTROLLER_MANAGER_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--address=127.0.0.1 \</span><br><span class="line">--master=http://127.0.0.1:8080 \</span><br><span class="line">--allocate-node-cidrs=true \</span><br><span class="line">--service-cluster-ip-range=10.254.0.0/16 \</span><br><span class="line">--cluster-cidr=172.30.0.0/16 \</span><br><span class="line">--cluster-name=kubernetes \</span><br><span class="line">--cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">--cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem  \</span><br><span class="line">--root-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">--service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">--leader-elect=true&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>–address的值必须为127.0.0.1,应为当前kube-apiserver期望scheduler和conntroller-manaager在同一台机器上；</li>
<li>–master=http://{master_ip}:8080：使用非安全的8080端口与kube-apiserver通信；</li>
<li>–cluster-cidr指定Cluster中Pod的CIDR范围，该网段在各Node必须路由可达（flanneld保证）</li>
<li>–service-cluster-ip-range参数指定Cluster中Service的CIDR范围，该网络在各Node间必须路由不可达，必须与kube-apiserver中的参数保持一致；</li>
<li>–cluster-signing-*指定的证书和私钥文件用来签名TLS BootStrap创建的证书和私钥</li>
<li>–root-ca-file用来对kube-apiserver证书进行校验，指定该参数后，才会在Pod容器的ServiceAccount中放置该CA证书文件</li>
<li>–leader-elect=true部署多台master集群时选举产生一直处于工作状态的kube-controller-manager进程；</li>
</ul>
<h4 id="systemd管理controller-manager组件"><a href="#systemd管理controller-manager组件" class="headerlink" title="systemd管理controller-manager组件"></a>systemd管理controller-manager组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/kube-controller-manager.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Controller Manager</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/etc/kubernetes/cfg/kube-controller-manager</span><br><span class="line">ExecStart=/usr/local/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动-2"><a href="#启动-2" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-controller-manager</span><br><span class="line">systemctl start kube-controller-manager</span><br><span class="line">systemctl status kube-controller-manager</span><br></pre></td></tr></table></figure>

<h3 id="验证master节点"><a href="#验证master节点" class="headerlink" title="验证master节点"></a>验证master节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># kubectl get componentstatuses</span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">scheduler            Healthy   ok                   </span><br><span class="line">controller-manager   Healthy   ok                   </span><br><span class="line">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="部署kubectl工具"><a href="#部署kubectl工具" class="headerlink" title="部署kubectl工具"></a>部署kubectl工具</h2><p>kubectl是kubernetes的集群管理工具，任何节点通过kubetcl都可以管理整个k8s集群。</p>
<h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## 控制节点</span><br><span class="line">cp -r kubernetes/server/bin/&#123;kubectl&#125; /usr/local/bin/</span><br></pre></td></tr></table></figure>

<h3 id="创建-root-kube-config文件"><a href="#创建-root-kube-config文件" class="headerlink" title="创建/root/.kube/config文件"></a>创建/root/.kube/config文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 设置集群参数,--server指定Master节点ip</span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=https://192.168.56.101:6443</span><br><span class="line"></span><br><span class="line"># 设置客户端认证参数</span><br><span class="line">kubectl config set-credentials admin \</span><br><span class="line">  --client-certificate=/etc/kubernetes/ssl/admin.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --client-key=/etc/kubernetes/ssl/admin-key.pem</span><br><span class="line"></span><br><span class="line"># 设置上下文参数</span><br><span class="line">kubectl config set-context kubernetes \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=admin</span><br><span class="line"></span><br><span class="line"># 设置默认上下文</span><br><span class="line">kubectl config use-context kubernetes</span><br></pre></td></tr></table></figure>
<ul>
<li>admin.pem：证书O字段值为system:masters，kube-apiserver预定义的RoleBinding cluster-admin将Group system:master与Role cluster-admin绑定，该Role 授予了调用Kube-apiserver相关的API权限</li>
</ul>
<h3 id="创建bootstartp-kubeconfig文件"><a href="#创建bootstartp-kubeconfig文件" class="headerlink" title="创建bootstartp.kubeconfig文件"></a>创建bootstartp.kubeconfig文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 设置集群参数--server为master节点ip</span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=https://192.168.56.101:6443 \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line"># 设置客户端认证参数</span><br><span class="line">kubectl config set-credentials kubelet-bootstrap \</span><br><span class="line">  --token=$&#123;BOOTSTRAP_TOKEN&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line"># 设置上下文参数</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kubelet-bootstrap \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line"># 设置默认上下文</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">mv bootstrap.kubeconfig /etc/kubernetes/cfg</span><br></pre></td></tr></table></figure>

<h4 id="创建kube-proxy-kubeconfig"><a href="#创建kube-proxy-kubeconfig" class="headerlink" title="创建kube-proxy.kubeconfig"></a>创建kube-proxy.kubeconfig</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 设置集群参数 --server参数为master ip</span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=https://192.168.56.101:6443 \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line"># 设置客户端认证参数</span><br><span class="line">kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=/etc/kubernetes/ssl/kube-proxy.pem \</span><br><span class="line">  --client-key=/etc/kubernetes/ssl/kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line"># 设置上下文参数</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line"># 设置默认上下文</span><br><span class="line">kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">mv kube-proxy.kubeconfig /etc/kubernetes/cfg</span><br></pre></td></tr></table></figure>
<ul>
<li>设置集群参数和客户端认证参数，–embed-certs都为true，这会将certificate-authority，client-cretificate和client-key指向的证书文件内容写入到生成的kube-proxy.kebuconfig文件中；</li>
<li>kube-proxy.pem证书中CN为system:kube-proxy,kube-apiserver预定义的RoleBinding cluster-admin将User system:kube-proxy与Role system:node-proxy绑定，该Role授予了调用kube-apiserver Proxy相关的api权限；</li>
</ul>
<h4 id="将生成的配置文件拷贝到其他的节点"><a href="#将生成的配置文件拷贝到其他的节点" class="headerlink" title="将生成的配置文件拷贝到其他的节点"></a>将生成的配置文件拷贝到其他的节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/kubernetes/kube-proxy.kubeconfig node01:/etc/kubernetes/cfg</span><br><span class="line">scp /etc/kubernetes/kube-proxy.kubeconfig node02:/etc/kubernetes/cfg</span><br><span class="line">  </span><br><span class="line">scp /etc/kubernetes/bootstrap.kubeconfig node01:/etc/kubernetes/cfg</span><br><span class="line">scp /etc/kubernetes/bootstrap.kubeconfig node02:/etc/kubernetes/cfg</span><br></pre></td></tr></table></figure>

<h2 id="部署Node节点"><a href="#部署Node节点" class="headerlink" title="部署Node节点"></a>部署Node节点</h2><p>kubelet在启动时向kube-apiserver发送TLS bootstrapping请求，需要先将bootstrap token文件中的kubelet-bootstrap用户赋予system:node-bootstrapper角色，然后kubelet才有权限创建认证请求。</p>
<h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><p>在master上运行一次即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</span><br></pre></td></tr></table></figure>

<h3 id="安装kubelet和kube-proxy"><a href="#安装kubelet和kube-proxy" class="headerlink" title="安装kubelet和kube-proxy"></a>安装kubelet和kube-proxy</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## 数据节点</span><br><span class="line">cp -r kubernetes/server/bin/&#123;kube-proxy,kubelet&#125; /usr/local/bin/</span><br></pre></td></tr></table></figure>

<h3 id="创建kubelet配置文件"><a href="#创建kubelet配置文件" class="headerlink" title="创建kubelet配置文件"></a>创建kubelet配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/cfg/kubelet</span><br><span class="line"></span><br><span class="line">KUBELET_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--hostname-override=192.168.56.101 \</span><br><span class="line">--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0 \</span><br><span class="line">--bootstrap-kubeconfig=/etc/kubernetes/cfg/bootstrap.kubeconfig \</span><br><span class="line">--kubeconfig=/etc/kubernetes/cfg/kubelet.kubeconfig \</span><br><span class="line">--cert-dir=/etc/kubernetes/ssl&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>–hostname-override 在集群中显示的主机名</li>
<li>–kubeconfig 指定kubeconfig文件位置，会自动生成</li>
<li>–bootstrap-kubeconfig 指定刚才生成的bootstrap.kubeconfig文件</li>
<li>–cert-dir 颁发证书存放位置</li>
<li>–pod-infra-container-image 管理Pod网络的镜像</li>
</ul>
<h3 id="systemd管理kubelet组件"><a href="#systemd管理kubelet组件" class="headerlink" title="systemd管理kubelet组件"></a>systemd管理kubelet组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/kubelet.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet</span><br><span class="line">After=docker.service</span><br><span class="line">Requires=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/etc/kubernetes/cfg/kubelet</span><br><span class="line">ExecStart=/usr/local/bin/kubelet $KUBELET_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">KillMode=process</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h3 id="启动-3"><a href="#启动-3" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kubelet</span><br><span class="line">systemctl start kubelet</span><br><span class="line">systemctl status kubelet</span><br></pre></td></tr></table></figure>

<h3 id="执行TLS证书授权请求"><a href="#执行TLS证书授权请求" class="headerlink" title="执行TLS证书授权请求"></a>执行TLS证书授权请求</h3><p>kubelet首次启动时像kube-apiserver发送证书签名求情，必须通过授权后，才会添加到集群。<br>查询授权请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># kubectl get csr</span><br><span class="line">NAME                                                   AGE       REQUESTOR           CONDITION</span><br><span class="line">node-csr-450A0zCMYrGxWozsNukv6vh2NdBspA-hr6Rsz-LA9ro   3m        kubelet-bootstrap   Pending</span><br><span class="line">node-csr-5t_AUkaEhT98xX1g7zTpzaNzRB9rXh453i2Fu_yxvvs   3m        kubelet-bootstrap   Pending</span><br><span class="line">node-csr-p9r9gusX2kTGpyYFPlkoaSGyatLQmtDmL8NBee2D_s8   3m        kubelet-bootstrap   Pending</span><br></pre></td></tr></table></figure>

<p>同意授权请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># kubectl certificate approve node-csr-450A0zCMYrGxWozsNukv6vh2NdBspA-hr6Rsz-LA9ro</span><br><span class="line">certificatesigningrequest &quot;node-csr-450A0zCMYrGxWozsNukv6vh2NdBspA-hr6Rsz-LA9ro&quot; approved</span><br><span class="line"></span><br><span class="line"># kubectl certificate approve node-csr-5t_AUkaEhT98xX1g7zTpzaNzRB9rXh453i2Fu_yxvvs</span><br><span class="line">certificatesigningrequest &quot;node-csr-5t_AUkaEhT98xX1g7zTpzaNzRB9rXh453i2Fu_yxvvs&quot; approved</span><br><span class="line"></span><br><span class="line"># kubectl certificate approve node-csr-p9r9gusX2kTGpyYFPlkoaSGyatLQmtDmL8NBee2D_s8</span><br><span class="line">certificatesigningrequest &quot;node-csr-p9r9gusX2kTGpyYFPlkoaSGyatLQmtDmL8NBee2D_s8&quot; approved</span><br></pre></td></tr></table></figure>

<p>查看所有集群节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># kubectl get nodes</span><br><span class="line">NAME             STATUS   ROLES    AGE   VERSION</span><br><span class="line">192.168.56.101   Ready    &lt;none&gt;   15s   v1.16.3</span><br><span class="line">192.168.56.102   Ready    &lt;none&gt;   26s   v1.16.3</span><br><span class="line">192.168.56.103   Ready    &lt;none&gt;   7s    v1.16.3</span><br></pre></td></tr></table></figure>

<h3 id="创建kube-proxy配置文件"><a href="#创建kube-proxy配置文件" class="headerlink" title="创建kube-proxy配置文件"></a>创建kube-proxy配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/cfg/kube-proxy</span><br><span class="line"></span><br><span class="line">KUBE_PROXY_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--hostname-override=192.168.56.101 \</span><br><span class="line">--cluster-cidr=10.254.0.0/16 \</span><br><span class="line">--kubeconfig=/etc/kubernetes/cfg/kube-proxy.kubeconfig&quot;</span><br></pre></td></tr></table></figure>

<h3 id="systemd管理kube-proxy组件"><a href="#systemd管理kube-proxy组件" class="headerlink" title="systemd管理kube-proxy组件"></a>systemd管理kube-proxy组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/kube-proxy.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Proxy</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/etc/kubernetes/cfg/kube-proxy</span><br><span class="line">ExecStart=/usr/local/bin/kube-proxy $KUBE_PROXY_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h3 id="启动-4"><a href="#启动-4" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-proxy</span><br><span class="line">systemctl start kube-proxy</span><br><span class="line">systemctl status kube-proxy</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/%E5%AE%B9%E5%99%A8/">容器</a></div><div class="post-nav"><a class="pre" href="/2019/09/24/python/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/">代码规范</a><a class="next" href="/2019/09/04/%E5%AE%B9%E5%99%A8/kubernetes/k8s%E8%AF%81%E4%B9%A6(CFSSL)/">公钥基础设施(PKI)/CFSSL证书生成工具的使用</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://cunmin1718.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Beat/">Beat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES/">ES</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kibana/">Kibana</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Logstash/">Logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nexus/">Nexus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/drill/">drill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ganglia/">ganglia</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gitLab/">gitLab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/greenplum/">greenplum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/greenplum/PostgreSQL/">PostgreSQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/impala/">impala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle/">oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/seaweed/">seaweed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" style="font-size: 15px;">数据仓库</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 15px;">杂谈</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 15px;">容器</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" style="font-size: 15px;">项目开发</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">运维</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/hadoop%E4%BD%93%E7%B3%BB/" style="font-size: 15px;">hadoop体系</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" style="font-size: 15px;">文件存储</a> <a href="/tags/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/" style="font-size: 15px;">分析引擎</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/" style="font-size: 15px;">运维监控</a> <a href="/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" style="font-size: 15px;">日志收集</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/ELK/Logstash/pipeline%E9%85%8D%E7%BD%AE/">pipeline配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/ELK/Logstash/Logstash%E4%BB%8B%E7%BB%8D/">Logstash介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/ELK/FileBeat6.4%E5%AE%89%E8%A3%85/">FileBeat6.4 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/ELK/Logstash/logstash7.4%20%E9%85%8D%E7%BD%AE/">Logstash7.4 配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/ELK/Kibana/Kibana7.4%E5%AE%89%E8%A3%85/">Kibana7.4安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/02/%E5%A4%A7%E6%95%B0%E6%8D%AE/ELK/ElasticSearch/ES%207.4%E5%AE%89%E8%A3%85/">ES 7.4安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/02/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/Maven/15.%20%E6%8F%92%E4%BB%B6maven-enforcer-plugin/">插件maven-enforcer-plugin</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/02/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/Maven/14.%20%E6%8F%92%E4%BB%B6build-helper-maven-plugin/">插件build-helper-maven-plugin</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/02/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/Inmon%20%20VS%20Kimball/">3. Bill Inmon  VS. Ralph Kimball</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/30/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E8%AE%BE%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%96%B9%E6%B3%95/">2. 数据仓库建设中的数据建模方法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">记忆不靠谱.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>