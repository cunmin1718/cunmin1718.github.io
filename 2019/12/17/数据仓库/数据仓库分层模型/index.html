<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人笔记"><title>数据仓库分层模型 | 记忆不靠谱</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">数据仓库分层模型</h1><a id="logo" href="/.">记忆不靠谱</a><p class="description">人生很奇妙，过好每一天</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">数据仓库分层模型</h1><div class="post-meta">Dec 17, 2019<span> | </span><span class="category"><a href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么要分层？"><span class="toc-number">1.</span> <span class="toc-text">为什么要分层？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的分层方法"><span class="toc-number">2.</span> <span class="toc-text">常见的分层方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-stage-缓冲层"><span class="toc-number">2.1.</span> <span class="toc-text">1. stage 缓冲层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ODS-DWD层-Operational-Data-Store-data-warehouse-detail）操作数据存储-明细层"><span class="toc-number">2.2.</span> <span class="toc-text">1. ODS/DWD层 (Operational Data Store/data warehouse detail）操作数据存储/明细层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-DW-B-S-数据汇总层"><span class="toc-number">2.3.</span> <span class="toc-text">2. DW(B/S) 数据汇总层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DWB-data-warehouse-basis-轻度汇总层"><span class="toc-number">2.3.1.</span> <span class="toc-text">DWB(data warehouse basis) 轻度汇总层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DWS（data-warehouse-service）主题层"><span class="toc-number">2.3.2.</span> <span class="toc-text">DWS（data warehouse service）主题层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#APP层"><span class="toc-number">2.4.</span> <span class="toc-text">APP层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TMP层"><span class="toc-number">2.5.</span> <span class="toc-text">TMP层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DIM维度表"><span class="toc-number">2.6.</span> <span class="toc-text">DIM维度表</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="为什么要分层？"><a href="#为什么要分层？" class="headerlink" title="为什么要分层？"></a>为什么要分层？</h2><ul>
<li>清晰数据结构：每一个数据分层都有它的作用域，这样我们在使用表的时候能更方便地定位和理解。</li>
<li>数据血缘追踪：简单来讲可以这样理解，我们最终给业务诚信的是一能直接使用的张业务表，但是它的来源有很多，如果有一张来源表出问题了，我们希望能够快速准确地定位到问题，并清楚它的危害范围。</li>
<li>减少重复开发：规范数据分层，开发一些通用的中间层数据，能够减少极大的重复计算。</li>
<li>把复杂问题简单化。讲一个复杂的任务分解成多个步骤来完成，每一层只处理单一的步骤，比较简单和容易理解。而且便于维护数据的准确性，当数据出现问题之后，可以不用修复所有的数据，只需要从有问题的步骤开始修复。</li>
<li>屏蔽原始数据的异常。</li>
<li>屏蔽业务的影响，不必改一次业务就需要重新接入数据。</li>
</ul>
<h2 id="常见的分层方法"><a href="#常见的分层方法" class="headerlink" title="常见的分层方法"></a>常见的分层方法</h2><h3 id="1-stage-缓冲层"><a href="#1-stage-缓冲层" class="headerlink" title="1. stage 缓冲层"></a>1. stage 缓冲层</h3><ul>
<li>概念：又称为接口层(stage)，用于存储每天的增量数据和变更数据，如Canal接收的业务变更日志。</li>
<li>数据生成方式：直接从kafka接收源数据，需要业务表每天生成update,delete,inseret数据，只生成insert数据的业务表，数据直接入明细层</li>
<li>讨论方案：只把canal日志直接入缓冲层，如果其它有拉链数据的业务，也入缓冲层。</li>
<li>日志存储方式：使用impala外表，parquet文件格式，方便需要MR处理的数据读取。</li>
<li>日志删除方式：长久存储，可只存储最近几天的数据。讨论方案：直接长久存储</li>
<li>表schema：一般按天创建分区</li>
</ul>
<p>STAGE层中的表结构和数据定义一般与业务系统保持一致。<br>Stage中的数据可以每次全量接入也可以每次增量接入，一般都有会数据老化的机制，不用长期保存。<br>Stage的数据不会对外部开放。</p>
<h3 id="1-ODS-DWD层-Operational-Data-Store-data-warehouse-detail）操作数据存储-明细层"><a href="#1-ODS-DWD层-Operational-Data-Store-data-warehouse-detail）操作数据存储-明细层" class="headerlink" title="1. ODS/DWD层 (Operational Data Store/data warehouse detail）操作数据存储/明细层"></a>1. ODS/DWD层 (Operational Data Store/data warehouse detail）操作数据存储/明细层</h3><ul>
<li>概念：是数据仓库的细节数据层，是对STAGE层数据进行沉淀，减少了抽取的复杂性，同时ODS/DWD的信息模型组织主要遵循企业业务事务处理的形式，将各个专业数据进行集中，明细层跟stage层的粒度一致，属于分析的公共资源</li>
<li>数据生成方式：部分数据直接来自kafka，部分数据为接口层数据与历史数据合成。</li>
</ul>
<p>讨论方案：<br>canal数据的合成方式为：每天把明细层的前天全量数据和昨天新数据合成一个新的数据表，覆盖旧表。同时使用历史镜像，按周/按月/按年 存储一个历史镜像到新表。<br>日志存储方式：直接数据使用impala外表，parquet文件格式，canal合成数据为二次生成数据，建议使用内表，下面几层都是从impala生成的数据，建议都用内表+静态/动态分区。<br>日志删除方式：长久存储。<br>表schema：一般按天创建分区，没有时间概念的按具体业务选择分区字段。</p>
<p><strong><em>数据在装入本层前需要做以下工作：</em></strong></p>
<ul>
<li>去噪（例如去掉明显偏离正常水平的银行刷卡信息）</li>
<li>去重（例如银行账户信息、公安局人口信息中均含有人的姓名，但是只保留一份即可）</li>
<li>提脏（例如有的人的银行卡被盗刷，在十分钟内同时有两笔分别在中国和日本的刷卡信息，这便是脏数据)</li>
<li>业务提取</li>
<li>单位统一</li>
<li>砍字段（例如用于支撑前端系统工作，但是在数据挖掘中不需要的字段）</li>
<li>业务判别</li>
</ul>
<h3 id="2-DW-B-S-数据汇总层"><a href="#2-DW-B-S-数据汇总层" class="headerlink" title="2. DW(B/S) 数据汇总层"></a>2. DW(B/S) 数据汇总层</h3><p>功能：<br>为DW、ST层提供细粒度数据，细化成DWB 和 DWS；</p>
<h4 id="DWB-data-warehouse-basis-轻度汇总层"><a href="#DWB-data-warehouse-basis-轻度汇总层" class="headerlink" title="DWB(data warehouse basis) 轻度汇总层"></a>DWB(data warehouse basis) 轻度汇总层</h4><ul>
<li>概念：轻度汇总层数据仓库中DWD层和DM层之间的一个过渡层次，是对DWD层的生产数据进行轻度综合和汇总统计(可以把复杂的清洗，处理包含，如根据PV日志生成的会话数据)。轻度综合层与DWD的主要区别在于二者的应用领域不同，DWD的数据来源于生产型系统，并未满意一些不可预见的需求而进行沉淀;轻度综合层则面向分析型应用进行细粒度的统计和沉淀</li>
<li>数据生成方式：由明细层按照一定的业务需求生成轻度汇总表。明细层需要复杂清洗的数据和需要MR处理的数据也经过处理后接入到轻度汇总层。</li>
<li>日志存储方式：内表，parquet文件格式。</li>
<li>日志删除方式：长久存储。</li>
<li>表schema：一般按天创建分区，没有时间概念的按具体业务选择分区字段。</li>
</ul>
<h4 id="DWS（data-warehouse-service）主题层"><a href="#DWS（data-warehouse-service）主题层" class="headerlink" title="DWS（data warehouse service）主题层"></a>DWS（data warehouse service）主题层</h4><ul>
<li>概念：又称数据集市或宽表。按照业务划分，如流量、订单、用户等，生成字段比较多的宽表，用于提供后续的业务查询，OLAP分析，数据分发等。</li>
<li>数据生成方式：由轻度汇总层和明细层数据计算生成。</li>
<li>日志存储方式：使用impala内表，parquet文件格式。</li>
<li>日志删除方式：长久存储。</li>
<li>表schema：一般按天创建分区，没有时间概念的按具体业务选择分区字段。<br>库与表命名。库名：dm,表名：初步考虑格式为：dm日期业务表名,待定。</li>
</ul>
<h3 id="APP层"><a href="#APP层" class="headerlink" title="APP层"></a>APP层</h3><p>数据产品层（APP），这一层是提供为数据产品使用的结果数据。</p>
<p>从数据粒度来说是高度汇总的数据。从数据的广度来说，则并不一定会覆盖所有业务数据。从极端情况来说，可以为每一张报表在APP层构建一个模型来支持，达到以空间换时间的目的。</p>
<p>应用层是根据业务需要，由前面三层数据统计而出的结果，可以直接提供查询展现，或导入至Mysql中使用。</p>
<p>需要一个管理元数据信息的系统能够提供方便的元数据的操作和查询操作</p>
<p>主要是提供给数据产品和数据分析使用的数据，一般会存放在es、mysql等系统中供线上系统使用，也可能会存在Hive或者Druid中供数据分析和数据挖掘使用</p>
<p>我们经常说的报表数据，或者说那种大宽表，一般就放在这里</p>
<p>数据仓库的标准分层只是一个建议性质的标准，实际实施时需要根据实际情况确定数据仓库的分层，不同类型的数据也可能采取不同的分层方法。</p>
<h3 id="TMP层"><a href="#TMP层" class="headerlink" title="TMP层"></a>TMP层</h3><p>每一层的计算都会有很多临时表，专设一个TMP层来存储我们数据仓库的临时表</p>
<h3 id="DIM维度表"><a href="#DIM维度表" class="headerlink" title="DIM维度表"></a>DIM维度表</h3><p>也叫数据字典DICT，比如国家代码和国家名、地理位置、中文名、国旗图片等</p>
</div><div class="tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></div><div class="post-nav"><a class="pre" href="/2019/12/18/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E6%8B%89%E9%93%BE%E8%A1%A8/">Hive 拉链表</a><a class="next" href="/2019/12/13/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PostgreSQL%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">PostgreSQL常用命令</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://cunmin1718.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Beat/">Beat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES/">ES</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kibana/">Kibana</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Logstash/">Logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NIFI/">NIFI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nexus/">Nexus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/drill/">drill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ganglia/">ganglia</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gitLab/">gitLab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/greenplum/">greenplum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/greenplum/PostgreSQL/">PostgreSQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/impala/">impala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle/">oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scrapy/">scrapy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/seaweed/">seaweed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 15px;">杂谈</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" style="font-size: 15px;">数据仓库</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 15px;">容器</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" style="font-size: 15px;">项目开发</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">运维</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/hadoop%E4%BD%93%E7%B3%BB/" style="font-size: 15px;">hadoop体系</a> <a href="/tags/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/" style="font-size: 15px;">分析引擎</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" style="font-size: 15px;">文件存储</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" style="font-size: 15px;">日志收集</a> <a href="/tags/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/" style="font-size: 15px;">运维监控</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/26/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/nifi/NiFi%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/">NiFi用户指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/20/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/nifi/nifi%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/">nifi组件介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/15/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/greenplum/%E5%88%86%E5%8C%BA%E8%A1%A8/">分区表</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/07/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PrepareStatement%E7%9A%84%E5%8A%9F%E4%B8%8E%E8%BF%87/">PrepareStatement的功与过</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/05/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/greenplum/%E8%B5%84%E6%BA%90%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86/">资源队列管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/30/python/python/Python%E5%B8%B8%E7%94%A8%E5%86%85%E5%BB%BA%E6%96%B9%E6%B3%95/">Python常用内建方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/29/python/python/args%E5%92%8Ckwargs%E7%9A%84%E5%8C%BA%E5%88%AB/">args和kwargs的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%E9%85%8D%E7%BD%AE/">redis配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%E5%AE%89%E8%A3%85/">redis安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/12/python/scrapy/Middleware/HTTP%E7%BC%93%E5%AD%98%E4%B8%8E%E7%A6%BB%E7%BA%BF%E5%B7%A5%E4%BD%9C/">4. HTTP缓存与离线工作</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">记忆不靠谱.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>