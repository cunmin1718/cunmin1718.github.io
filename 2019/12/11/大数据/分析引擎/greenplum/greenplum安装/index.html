<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人笔记"><title>greenplum安装 | 记忆不靠谱</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">greenplum安装</h1><a id="logo" href="/.">记忆不靠谱</a><p class="description">人生很奇妙，过好每一天</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">greenplum安装</h1><div class="post-meta">Dec 11, 2019<span> | </span><span class="category"><a href="/categories/greenplum/">greenplum</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建用户"><span class="toc-number">1.</span> <span class="toc-text">创建用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加greenplum用户"><span class="toc-number">1.1.</span> <span class="toc-text">添加greenplum用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户加入sudo权限"><span class="toc-number">1.2.</span> <span class="toc-text">用户加入sudo权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-Greenplum-DB-–-Master"><span class="toc-number">2.</span> <span class="toc-text">安装 Greenplum DB – Master</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#执行命令安装"><span class="toc-number">2.1.</span> <span class="toc-text">执行命令安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#赋权限"><span class="toc-number">2.2.</span> <span class="toc-text">赋权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用环境变量"><span class="toc-number">2.3.</span> <span class="toc-text">应用环境变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-Greenplum-DB-–-Segment"><span class="toc-number">3.</span> <span class="toc-text">安装 Greenplum DB – Segment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#免密登录"><span class="toc-number">3.1.</span> <span class="toc-text">免密登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建公私钥对"><span class="toc-number">3.1.1.</span> <span class="toc-text">创建公私钥对</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加信任其他机器的Host-key"><span class="toc-number">3.1.2.</span> <span class="toc-text">添加信任其他机器的Host key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-hostlist，seg-hosts-Master"><span class="toc-number">3.1.3.</span> <span class="toc-text">创建 hostlist，seg_hosts  (Master)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-gpssh-exkeys-打通所有服务器-Master"><span class="toc-number">3.2.</span> <span class="toc-text">使用 gpssh-exkeys 打通所有服务器  (Master)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分发数据库文件"><span class="toc-number">4.</span> <span class="toc-text">分发数据库文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分发"><span class="toc-number">4.1.</span> <span class="toc-text">分发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解压"><span class="toc-number">4.2.</span> <span class="toc-text">解压</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#环境配置"><span class="toc-number">5.</span> <span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建数据存储空间"><span class="toc-number">5.1.</span> <span class="toc-text">创建数据存储空间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Master"><span class="toc-number">5.1.1.</span> <span class="toc-text">Master</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Segment"><span class="toc-number">5.1.2.</span> <span class="toc-text">Segment</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置-环境变量（每台机器都配）"><span class="toc-number">5.2.</span> <span class="toc-text">配置 环境变量（每台机器都配）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化配置文件"><span class="toc-number">5.3.</span> <span class="toc-text">初始化配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#configuration-file"><span class="toc-number">5.3.1.</span> <span class="toc-text">configuration file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#host-file"><span class="toc-number">5.3.2.</span> <span class="toc-text">host file</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化数据库"><span class="toc-number">6.</span> <span class="toc-text">初始化数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#失败时回滚"><span class="toc-number">6.1.</span> <span class="toc-text">失败时回滚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装后的环境变量"><span class="toc-number">7.</span> <span class="toc-text">安装后的环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MASTER-DATA-DIRECTORY"><span class="toc-number">7.1.</span> <span class="toc-text">MASTER_DATA_DIRECTORY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Optional-配置客户端环境"><span class="toc-number">7.2.</span> <span class="toc-text">(Optional) 配置客户端环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-7需要设置ps"><span class="toc-number">7.3.</span> <span class="toc-text">CentOS 7需要设置ps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#传给standyby-master"><span class="toc-number">7.4.</span> <span class="toc-text">传给standyby master</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#允许远程连接"><span class="toc-number">8.</span> <span class="toc-text">允许远程连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#刷新"><span class="toc-number">8.1.</span> <span class="toc-text">刷新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改密码"><span class="toc-number">9.</span> <span class="toc-text">修改密码</span></a></li></ol></div></div><div class="post-content"><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><h3 id="添加greenplum用户"><a href="#添加greenplum用户" class="headerlink" title="添加greenplum用户"></a>添加greenplum用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 530 gpadmin</span><br><span class="line">useradd -g 530 -u 530 -m -d /home/gpadmin -s /bin/bash gpadmin</span><br><span class="line">passwd gpadmin</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意:  不能将greenplum跑在root用户上</p>
</blockquote>
<h3 id="用户加入sudo权限"><a href="#用户加入sudo权限" class="headerlink" title="用户加入sudo权限"></a>用户加入sudo权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers</span><br><span class="line"></span><br><span class="line"># 添加如下内容</span><br><span class="line">gpadmin ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure>

<h2 id="安装-Greenplum-DB-–-Master"><a href="#安装-Greenplum-DB-–-Master" class="headerlink" title="安装 Greenplum DB – Master"></a>安装 Greenplum DB – Master</h2><h3 id="执行命令安装"><a href="#执行命令安装" class="headerlink" title="执行命令安装"></a>执行命令安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh greenplum-db-6.1.0-rhel7-x86_64.rpm.rpm</span><br></pre></td></tr></table></figure>

<h3 id="赋权限"><a href="#赋权限" class="headerlink" title="赋权限"></a>赋权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R gpadmin:gpadmin /usr/local/greenplum-db*</span><br></pre></td></tr></table></figure>

<h3 id="应用环境变量"><a href="#应用环境变量" class="headerlink" title="应用环境变量"></a>应用环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su gpadmin</span><br><span class="line">source /usr/local/greenplum-db-6.1.0/greenplum_path.sh</span><br></pre></td></tr></table></figure>

<h2 id="安装-Greenplum-DB-–-Segment"><a href="#安装-Greenplum-DB-–-Segment" class="headerlink" title="安装 Greenplum DB – Segment"></a>安装 Greenplum DB – Segment</h2><h3 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h3><h4 id="创建公私钥对"><a href="#创建公私钥对" class="headerlink" title="创建公私钥对"></a>创建公私钥对</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">ls -l /home/gpadmin/.ssh</span><br></pre></td></tr></table></figure>

<h4 id="添加信任其他机器的Host-key"><a href="#添加信任其他机器的Host-key" class="headerlink" title="添加信任其他机器的Host key"></a>添加信任其他机器的Host key</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id mdw</span><br><span class="line">ssh-copy-id sdw1</span><br><span class="line">ssh-copy-id sdw2</span><br></pre></td></tr></table></figure>

<h4 id="创建-hostlist，seg-hosts-Master"><a href="#创建-hostlist，seg-hosts-Master" class="headerlink" title="创建 hostlist，seg_hosts  (Master)"></a>创建 hostlist，seg_hosts  (Master)</h4><p>目录/home/gpadmin/conf，再分别创建hostlist，seg_hosts 。我这里 hostlist 中填写所有节点的主机别名，seg_hosts 中填写所有Segment 的主机别名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/gpadmin/conf</span><br><span class="line">cd /home/gpadmin/conf</span><br><span class="line">touch hostlist</span><br><span class="line">touch seg_hosts</span><br></pre></td></tr></table></figure>

<h3 id="使用-gpssh-exkeys-打通所有服务器-Master"><a href="#使用-gpssh-exkeys-打通所有服务器-Master" class="headerlink" title="使用 gpssh-exkeys 打通所有服务器  (Master)"></a>使用 gpssh-exkeys 打通所有服务器  (Master)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/gpadmin/conf</span><br><span class="line">gpssh-exkeys -f hostlist</span><br></pre></td></tr></table></figure>
<p>在打通所有机器通道之后，我们就可以使用 gpssh 命令对所有机器进行批量操作了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">=&gt; pwd</span><br><span class="line">[k8s03] /home/gpadmin</span><br><span class="line">[k8s01] /home/gpadmin</span><br><span class="line">[k8s02] /home/gpadmin</span><br><span class="line">=&gt; exit</span><br></pre></td></tr></table></figure>
<blockquote>
<p>备注：这是一个神奇的功能，原来我接触的集群部署，需要运行 SCP 远程拷贝命令。如果有100台，就需要操作100次。但是，这里只需要操作一次，就完成到全部集群的操作，前面带 “=&gt;”，exit 退出。</p>
</blockquote>
<h2 id="分发数据库文件"><a href="#分发数据库文件" class="headerlink" title="分发数据库文件"></a>分发数据库文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">tar -cf gp6.tar greenplum-db-6.1.0/</span><br><span class="line">chown -R gpadmin:gpadmin /usr/local/gp6.tar</span><br></pre></td></tr></table></figure>
<p>打包的时候权限不够，我换成root，然后再把.tar的权限还给gpadmin。</p>
<p>最后，要用gpadmin操作，因为前面设置了gpadmin免密。</p>
<h3 id="分发"><a href="#分发" class="headerlink" title="分发"></a>分发</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpscp -f /home/gpadmin/conf/hostlist gp6.tar =:/usr/local/greenplum</span><br></pre></td></tr></table></figure>

<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><p>在master上运行，一台上敲命令，操作4台。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gpssh -f /home/gpadmin/conf/hostlist</span><br><span class="line">=&gt; cd /usr/local/greenplum</span><br><span class="line">=&gt; tar -xf gp6.tar</span><br><span class="line">=&gt; ln -s greenplum-db-6.1.0 greenplum-db</span><br></pre></td></tr></table></figure>
<blockquote>
<p>或者在各台机器上使用rpm包安装</p>
</blockquote>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="创建数据存储空间"><a href="#创建数据存储空间" class="headerlink" title="创建数据存储空间"></a>创建数据存储空间</h3><p>以上安装的是程序，接下来要创建数据存储空间 。</p>
<h4 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h4><p>Master 不存储 user data，仅有 system catalog tables 和 system metadata ，我这里没有 Standby Master。所以，只在 Master 创建一个目录即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/gpadmin/data/master</span><br></pre></td></tr></table></figure>
<h4 id="Segment"><a href="#Segment" class="headerlink" title="Segment"></a>Segment</h4><p>数据存储在Segment 中，并且需要 primary segments 和 mirror segments，其余3台segment 用 gpssh分别创建2个目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source /usr/local/greenplum-db/greenplum_path.sh </span><br><span class="line">gpssh -f /home/gpadmin/conf/seg_hosts -e &apos;mkdir -p /home/gpadmin/data/primary&apos;</span><br><span class="line">gpssh -f /home/gpadmin/conf/seg_hosts -e &apos;mkdir -p /home/gpadmin/data/mirror&apos;</span><br></pre></td></tr></table></figure>

<h3 id="配置-环境变量（每台机器都配）"><a href="#配置-环境变量（每台机器都配）" class="headerlink" title="配置 环境变量（每台机器都配）"></a>配置 环境变量（每台机器都配）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /home/gpadmin/.bashrc</span><br><span class="line">增加：</span><br><span class="line">source /usr/local/greenplum-db-6.1.0/greenplum_path.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /home/gpadmin/.bash_profile</span><br></pre></td></tr></table></figure>
<p>查看是否起作用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $GPHOME</span><br></pre></td></tr></table></figure>

<h3 id="初始化配置文件"><a href="#初始化配置文件" class="headerlink" title="初始化配置文件"></a>初始化配置文件</h3><h4 id="configuration-file"><a href="#configuration-file" class="headerlink" title="configuration file"></a>configuration file</h4><p>模板在：<code>$GPHOME/docs/cli_help/gpconfigs/gpinitsystem_config</code>，拷贝过来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/gpadmin/gpconfigs</span><br><span class="line">cp $GPHOME/docs/cli_help/gpconfigs/gpinitsystem_config /home/gpadmin/gpconfigs/gpinitsystem_config</span><br></pre></td></tr></table></figure>

<p>至少需要2个segment实例，即使是单节点系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#数据库代号</span><br><span class="line">ARRAY_NAME=&quot;Greenplum&quot;</span><br><span class="line"></span><br><span class="line">#segment前缀</span><br><span class="line">SEG_PREFIX=gpseg</span><br><span class="line"></span><br><span class="line">#primary segment 起始的端口号</span><br><span class="line">PORT_BASE=6000</span><br><span class="line"></span><br><span class="line">#指定primary segment的数据目录,网上写的是多个相同目录，多个目录表示一台机器有多个segment</span><br><span class="line"># 列出的路径数量决定了再每个物理host上创建几个segment节点；</span><br><span class="line"># greenplum会在父路径下创建gpseg0,gpseg1等实际路径的文件夹</span><br><span class="line">declare -a DATA_DIRECTORY=(/home/gpadmin/data/primary)</span><br><span class="line"></span><br><span class="line">#master所在机器的host name</span><br><span class="line">MASTER_HOSTNAME=mdw</span><br><span class="line"></span><br><span class="line">#master的数据目录</span><br><span class="line">MASTER_DIRECTORY=/home/gpadmin/data/master</span><br><span class="line"></span><br><span class="line">#master的端口</span><br><span class="line">MASTER_PORT=5432</span><br><span class="line"></span><br><span class="line">#指定bash的版本</span><br><span class="line">TRUSTED_SHELL=/usr/bin/ssh</span><br><span class="line"></span><br><span class="line">#将日志写入磁盘的间隔，每个段文件通常 =16MB &lt; 2 * CHECK_POINT_SEGMENTS + 1</span><br><span class="line">CHECK_POINT_SEGMENTS=8</span><br><span class="line"></span><br><span class="line">#字符集</span><br><span class="line">ENCODING=UTF-8</span><br><span class="line"></span><br><span class="line">#mirror segment 起始的端口号</span><br><span class="line">MIRROR_PORT_BASE=7000</span><br><span class="line"></span><br><span class="line"># mirror的数据目录，和主数据一样，一个对一个，多个对多个</span><br><span class="line">declare -a MIRROR_DATA_DIRECTORY=(/home/gpadmin/data/mirror)</span><br></pre></td></tr></table></figure>

<h4 id="host-file"><a href="#host-file" class="headerlink" title="host file"></a>host file</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/gpadmin/gpconfigs</span><br><span class="line">vim ~/gpconfigs/hostfile_gpinitsystem</span><br><span class="line"></span><br><span class="line"># 内容是所有segment节点的host</span><br><span class="line">sdw1</span><br><span class="line">sdw2</span><br></pre></td></tr></table></figure>

<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpinitsystem -c gpconfigs/gpinitsystem_config -h gpconfigs/hostfile_gpinitsystem</span><br></pre></td></tr></table></figure>

<h3 id="失败时回滚"><a href="#失败时回滚" class="headerlink" title="失败时回滚"></a>失败时回滚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 杀掉进程</span><br><span class="line">ps -aux | grep postgres</span><br><span class="line">pkill postgres</span><br><span class="line"># 删除lock文件</span><br><span class="line">gpssh -f conf/hostlist -e &apos;rm -rf /tmp/.s.PGSQL.6000.lock&apos;</span><br><span class="line"># 删除数据文件</span><br></pre></td></tr></table></figure>

<h2 id="安装后的环境变量"><a href="#安装后的环境变量" class="headerlink" title="安装后的环境变量"></a>安装后的环境变量</h2><h3 id="MASTER-DATA-DIRECTORY"><a href="#MASTER-DATA-DIRECTORY" class="headerlink" title="MASTER_DATA_DIRECTORY"></a>MASTER_DATA_DIRECTORY</h3><p>master节点设置<code>MASTER_DATA_DIRECTORY</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /home/gpadmin/.bashrc</span><br><span class="line">export MASTER_DATA_DIRECTORY=/home/gpadmin/data/master/gpseg-1</span><br><span class="line"></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<h3 id="Optional-配置客户端环境"><a href="#Optional-配置客户端环境" class="headerlink" title="(Optional) 配置客户端环境"></a>(Optional) 配置客户端环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PGPORT=5432</span><br><span class="line">export PGUSER=gpadmin</span><br><span class="line">#export PGDATABASE=default_login_database_name</span><br></pre></td></tr></table></figure>

<h3 id="CentOS-7需要设置ps"><a href="#CentOS-7需要设置ps" class="headerlink" title="CentOS 7需要设置ps"></a>CentOS 7需要设置ps</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=/lib64/libz.so.1 ps</span><br></pre></td></tr></table></figure>

<h3 id="传给standyby-master"><a href="#传给standyby-master" class="headerlink" title="传给standyby master"></a>传给standyby master</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.bashrc gpadmin@sdw1:/home/gpadmin</span><br></pre></td></tr></table></figure>

<h2 id="允许远程连接"><a href="#允许远程连接" class="headerlink" title="允许远程连接"></a>允许远程连接</h2><ul>
<li><p>greenplum的master节点的<code>pg_hba.conf</code>控制整个db系统的访问权限，默认已有一个可用的配置，允许master本机的host访问</p>
</li>
<li><p>segment节点不需要配置，只需要配置master节点的<code>pg_hba.conf</code></p>
</li>
<li><p>文件位置在master目录下：<code>$MASTER_DATA_DIRECTORY/pg_hba.conf</code></p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># TYPE	DATABASE	USER	CIDR-ADDRESS	METHOD</span><br><span class="line">host    all         all     0.0.0.0/0       md5</span><br></pre></td></tr></table></figure>
</li>
<li><p>TYPE定义了多种连接PostgreSQL的方式，分别是：“local”使用本地unix套接字，“host”使用TCP/IP连接</p>
</li>
<li><p>DATABASE指定哪个数据库，多个数据库，库名间以逗号分隔。</p>
</li>
<li><p>USER指定哪个数据库用户</p>
</li>
<li><p>CIDR-ADDRESS项local方式不必填写，该项可以是IPv4地址或IPv6地址，可以定义某台主机或某个网段。</p>
</li>
<li><p>METHOD指定如何处理客户端的认证。常用的有ident，md5，password，trust，reject。</p>
</li>
</ul>
<p>METHOD 说明：</p>
<ul>
<li>ident是Linux下PostgreSQL默认的local认证方式，凡是能正确登录服务器的操作系统用户（注：不是数据库用户）就能使用本用户映射的数据库用户不需密码登录数据库。</li>
<li>md5是常用的密码认证方式，如果你不使用ident，最好使用md5。密码是以md5形式传送给数据库，较安全，且不需建立同名的操作系统用户。</li>
<li>password是以明文密码传送给数据库，建议不要在生产环境中使用。</li>
<li>trust是只要知道数据库用户名就不需要密码或ident就能登录，建议不要在生产环境中使用。</li>
<li>reject是拒绝认证。</li>
</ul>
<h3 id="刷新"><a href="#刷新" class="headerlink" title="刷新"></a>刷新</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpstop -u</span><br></pre></td></tr></table></figure>

<h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p>使用gpinitsystem进行安装时可以指定密码，如果没指定，默认为<code>gparray</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER name WITH ENCRYPTED PASSWORD &apos;password&apos;</span><br><span class="line">CREATE ROLE name WITH LOGIN ENCRYPTED PASSWORD &apos;password&apos;</span><br><span class="line">ALTER USER name WITH ENCRYPTED PASSWORD &apos;password&apos;</span><br><span class="line">ALTER ROLE name WITH ENCRYPTED PASSWORD &apos;password&apos;</span><br><span class="line"></span><br><span class="line">查询所有user和role</span><br><span class="line">SELECT usename FROM pg_user;</span><br><span class="line">SELECT rolname FROM pg_roles;</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/">分析引擎</a></div><div class="post-nav"><a class="pre" href="/2019/12/12/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/greenplum/greenplum%E4%BC%98%E5%8C%96/">greenplum 优化</a><a class="next" href="/2019/12/11/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/greenplum/greenplum%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE/">greenplum环境设置</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://cunmin1718.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Beat/">Beat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES/">ES</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kibana/">Kibana</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Logstash/">Logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NIFI/">NIFI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nexus/">Nexus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/drill/">drill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ganglia/">ganglia</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gitLab/">gitLab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/greenplum/">greenplum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/greenplum/PostgreSQL/">PostgreSQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/impala/">impala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle/">oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scrapy/">scrapy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/seaweed/">seaweed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 15px;">杂谈</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" style="font-size: 15px;">数据仓库</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 15px;">容器</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" style="font-size: 15px;">项目开发</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">运维</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/hadoop%E4%BD%93%E7%B3%BB/" style="font-size: 15px;">hadoop体系</a> <a href="/tags/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/" style="font-size: 15px;">分析引擎</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" style="font-size: 15px;">文件存储</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" style="font-size: 15px;">日志收集</a> <a href="/tags/%E8%BF%90%E7%BB%B4%E7%9B%91%E6%8E%A7/" style="font-size: 15px;">运维监控</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/26/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/nifi/NiFi%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/">NiFi用户指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/20/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/nifi/nifi%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/">nifi组件介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/15/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/greenplum/%E5%88%86%E5%8C%BA%E8%A1%A8/">分区表</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/07/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PrepareStatement%E7%9A%84%E5%8A%9F%E4%B8%8E%E8%BF%87/">PrepareStatement的功与过</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/05/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E/greenplum/%E8%B5%84%E6%BA%90%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86/">资源队列管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/30/python/python/Python%E5%B8%B8%E7%94%A8%E5%86%85%E5%BB%BA%E6%96%B9%E6%B3%95/">Python常用内建方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/29/python/python/args%E5%92%8Ckwargs%E7%9A%84%E5%8C%BA%E5%88%AB/">args和kwargs的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%E9%85%8D%E7%BD%AE/">redis配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis%E5%AE%89%E8%A3%85/">redis安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/12/python/scrapy/Middleware/HTTP%E7%BC%93%E5%AD%98%E4%B8%8E%E7%A6%BB%E7%BA%BF%E5%B7%A5%E4%BD%9C/">4. HTTP缓存与离线工作</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">记忆不靠谱.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>